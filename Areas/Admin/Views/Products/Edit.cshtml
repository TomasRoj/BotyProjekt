@model BotyProjekt.Models.Product
@{
    Layout = null;
    var categories = ViewBag.Categories as List<BotyProjekt.Models.Category> ?? new();
    var colors = ViewBag.Colors as List<BotyProjekt.Models.Color> ?? new();
    var sizes = ViewBag.Sizes as List<BotyProjekt.Models.Size> ?? new();
    var variants = ViewBag.Variants as List<BotyProjekt.Models.ProductVariant> ?? new();
}

<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="utf-8" />
    <title>Editace produktu</title>
    <style>
        body { font-family: sans-serif; margin: 0; background: #f4f4f4; padding: 30px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h1 { color: #333; margin-bottom: 20px; }
        h2 { color: #555; margin-top: 30px; margin-bottom: 15px; border-bottom: 2px solid #28a745; padding-bottom: 10px; }
        h3 { color: #666; margin-top: 20px; margin-bottom: 15px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #333; }
        input, select, textarea { width: 100%; padding: 10px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
        textarea { min-height: 100px; }
        .btn { padding: 10px 20px; border: none; border-radius: 3px; cursor: pointer; font-size: 14px; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-back { background: #6c757d; color: white; text-decoration: none; display: inline-block; margin-right: 10px; }
        .btn-primary { background: #007bff; color: white; }
        .button-group { margin-top: 20px; }
        .variant-item { background: #f9f9f9; padding: 15px; margin-bottom: 10px; border-left: 4px solid #28a745; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; }
        .variant-info { flex: 1; }
        .variant-actions { display: flex; gap: 10px; flex-wrap: wrap; }
        .variant-section { background: #f5f5f5; padding: 20px; border-radius: 5px; margin-bottom: 20px; }
        .form-row { display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 15px; }
        .form-row .form-group { flex: 1; min-width: 200px; margin-bottom: 0; }
        .color-preview { width: 30px; height: 30px; border-radius: 50%; border: 2px solid #ccc; display: inline-block; margin-right: 10px; vertical-align: middle; }
        .no-variants { text-align: center; color: #999; padding: 20px; }
    </style>
</head>
<body>

    <div class="container">
        <a href="/Admin/Dashboard?section=products" class="btn btn-back">< Zpìt na produkty</a>

        <h1>Editace produktu: @Model.Name</h1>

        <form action="/Admin/Products/EditSubmit" method="post">
            @Html.AntiForgeryToken()
            <input type="hidden" name="id" value="@Model.Id" />

            <h2>Základní informace</h2>

            <div class="form-group">
                <label for="name">Název</label>
                <input id="name" name="name" value="@Model.Name" required />
            </div>

            <div class="form-group">
                <label for="description">Popis</label>
                <textarea id="description" name="description">@Model.Description</textarea>
            </div>

            <div class="form-group">
                <label for="basePrice">Cena</label>
                <input id="basePrice" name="basePrice" type="number" step="0.01" value="@Model.BasePrice" required />
            </div>

            <div class="form-group">
                <label for="discount">Sleva (%)</label>
                <input id="discount" name="discount" type="number" value="@Model.Discount" />
            </div>

            <div class="form-group">
                <label for="categoryId">Kategorie</label>
                <select id="categoryId" name="categoryId" required>
                    <option value="">-- Vyberte kategorii --</option>
                    @foreach (var cat in categories)
                    {
                        <option value="@cat.Id" @(Model.CategoryId == cat.Id ? "selected" : "")>@cat.Name</option>
                    }
                </select>
            </div>

            <div class="button-group">
                <button type="submit" name="saveBasic" value="true" class="btn btn-success">Uložit základní informace</button>
                <a href="/Admin/Dashboard?section=products" class="btn btn-back">Zrušit</a>
            </div>
        </form>

        <form action="/Admin/Products/EditSubmit" method="post">
            @Html.AntiForgeryToken()
            <input type="hidden" name="id" value="@Model.Id" />

            <h2>Varianty produktu</h2>

            <div class="variant-section">
                <h3>Pøidání nové varianty</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="newColorId">Barva</label>
                        <select id="newColorId" name="newColorId" required>
                            <option value="">-- Vyberte barvu --</option>
                            @foreach (var color in colors)
                            {
                                <option value="@color.Id">@color.Name</option>
                            }
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="newSizeId">Velikost</label>
                        <select id="newSizeId" name="newSizeId" required>
                            <option value="">-- Vyberte velikost --</option>
                            @foreach (var size in sizes)
                            {
                                <option value="@size.Id">@size.Name</option>
                            }
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="newPrice">Cena varianty (Kè)</label>
                        <input id="newPrice" name="newPrice" type="number" step="0.01" value="0.00" required />
                    </div>
                    <div class="form-group">
                        <label for="newStockQuantity">Skladová zásoba (ks)</label>
                        <input id="newStockQuantity" name="newStockQuantity" type="number" value="0" min="0" required />
                    </div>
                </div>

                <button type="submit" name="addVariant" value="true" class="btn btn-primary">+ Pøidat variantu</button>
            </div>

            @if (variants.Count > 0)
            {
                <h3>Stávající varianty (@variants.Count)</h3>
                <div id="variantsList">
                    @foreach (var variant in variants)
                    {
                        <div class="variant-item">
                            <div class="variant-info">
                                <strong>
                                    <span class="color-preview" style="background-color: @variant.Color.HexCode;"></span>
                                    @variant.Color.Name | Velikost: @variant.Size.Name
                                </strong>
                                <br />
                                <small>Cena: @variant.Price.ToString("F2") Kè | Stock: @variant.StockQuantity ks</small>
                            </div>
                            <div class="variant-actions">
                                <button type="submit" name="editVariant" value="@variant.Id" class="btn btn-primary" formaction="/Admin/Products/EditVariant">Upravit</button>
                                <button type="submit" name="deleteVariant" value="@variant.Id" class="btn btn-danger" formaction="/Admin/Products/DeleteVariant" onclick="return confirm('Chcete opravdu smazat tuto variantu?');">Smazat</button>
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <div class="no-variants">
                    <p>Zatím nejsou definovány žádné varianty produktu.</p>
                </div>
            }
        </form>
    </div>

</body>
</html>